<!DOCTYPE html>
<html>

<head>
<%- include('./partials/head') -%>
</head>

<body>
<header>
<%- include('./partials/header') -%>
<script src="https://www.google.com/recaptcha/api.js" async defer></script>
</header>

<div class="container my-5">
<div class="row">
<div class="col-md-6 mx-auto">

<div class="container">
      <h1>Register</h1>
      <form id="subscribeForm">
        <div class="form-group">
            <input type="text" class="form-control" id="username" name="username" placeholder="User Name"  required>
            <label for="username">User Name</label>
        </div>
        <div class="form-group">
            <input type="email" class="form-control" id="email" name="email" placeholder="name@example.com" maxlength="20" requiredlength="10" required>
            <label for="email">Email address</label>
        </div>
        <div class="form-floating">
            <input type="password" class="form-control" id="password" name="password" placeholder="Password"  maxlength="25" requiredlength="5"
             title="Password must be at least 11 characters 11. A strong password is above 17 characters." required>
            <label for="password">Password</label>
            </div>
        <div class="form-group">
          <div
            class="g-recaptcha"
            data-sitekey="6LfJLBMnAAAAAOWmTyLkvueCGXzZP-OR0I72bFPm"
          ></div>
        </div>
        <input type="submit" value="Submit" class="btn btn-primary" />
      </form>
    </div>

    <script>
      document.getElementById('subscribeForm').addEventListener('submit', e => {
        e.preventDefault();

        const name = document.querySelector('#name').value;
        const email = document.querySelector('#email').value;
        const captcha = document.querySelector('#g-recaptcha-response').value;

        return fetch('/register', {
          method: 'POST',
          headers: { 'Content-type': 'application/json' },
          body: JSON.stringify({ name, email, captcha })
        })
          .then(res => res.json())
          .then(data => {
            console.log(data);
            alert(data.msg);
            if (data.success) return location.reload();
          });
      });
    </script>
  </body>

</div>
</div>
</div>

<footer>
<%- include('./partials/footer') -%>
</footer>

</body>

</html>